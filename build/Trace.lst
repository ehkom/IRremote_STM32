ARM GAS  /tmp/ccQbm98O.s 			page 1


   1              		.cpu cortex-m3
   2              		.eabi_attribute 20, 1
   3              		.eabi_attribute 21, 1
   4              		.eabi_attribute 23, 3
   5              		.eabi_attribute 24, 1
   6              		.eabi_attribute 25, 1
   7              		.eabi_attribute 26, 1
   8              		.eabi_attribute 30, 1
   9              		.eabi_attribute 34, 1
  10              		.eabi_attribute 18, 4
  11              		.file	"Trace.c"
  12              		.text
  13              	.Ltext0:
  14              		.cfi_sections	.debug_frame
  15              		.section	.text.trace_printf,"ax",%progbits
  16              		.align	1
  17              		.global	trace_printf
  18              		.syntax unified
  19              		.thumb
  20              		.thumb_func
  21              		.fpu softvfp
  23              	trace_printf:
  24              	.LFB1:
  25              		.file 1 "Src/diag/Trace.c"
   1:Src/diag/Trace.c **** /*
   2:Src/diag/Trace.c ****  * This file is part of the ÂµOS++ distribution.
   3:Src/diag/Trace.c ****  *   (https://github.com/micro-os-plus)
   4:Src/diag/Trace.c ****  * Copyright (c) 2014 Liviu Ionescu.
   5:Src/diag/Trace.c ****  *
   6:Src/diag/Trace.c ****  * Permission is hereby granted, free of charge, to any person
   7:Src/diag/Trace.c ****  * obtaining a copy of this software and associated documentation
   8:Src/diag/Trace.c ****  * files (the "Software"), to deal in the Software without
   9:Src/diag/Trace.c ****  * restriction, including without limitation the rights to use,
  10:Src/diag/Trace.c ****  * copy, modify, merge, publish, distribute, sublicense, and/or
  11:Src/diag/Trace.c ****  * sell copies of the Software, and to permit persons to whom
  12:Src/diag/Trace.c ****  * the Software is furnished to do so, subject to the following
  13:Src/diag/Trace.c ****  * conditions:
  14:Src/diag/Trace.c ****  *
  15:Src/diag/Trace.c ****  * The above copyright notice and this permission notice shall be
  16:Src/diag/Trace.c ****  * included in all copies or substantial portions of the Software.
  17:Src/diag/Trace.c ****  *
  18:Src/diag/Trace.c ****  * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
  19:Src/diag/Trace.c ****  * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
  20:Src/diag/Trace.c ****  * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
  21:Src/diag/Trace.c ****  * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
  22:Src/diag/Trace.c ****  * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
  23:Src/diag/Trace.c ****  * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  24:Src/diag/Trace.c ****  * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
  25:Src/diag/Trace.c ****  * OTHER DEALINGS IN THE SOFTWARE.
  26:Src/diag/Trace.c ****  */
  27:Src/diag/Trace.c **** 
  28:Src/diag/Trace.c **** // ----------------------------------------------------------------------------
  29:Src/diag/Trace.c **** 
  30:Src/diag/Trace.c **** #if defined(TRACE)
  31:Src/diag/Trace.c **** 
  32:Src/diag/Trace.c **** #include <stdio.h>
  33:Src/diag/Trace.c **** #include <stdarg.h>
ARM GAS  /tmp/ccQbm98O.s 			page 2


  34:Src/diag/Trace.c **** #include "diag/Trace.h"
  35:Src/diag/Trace.c **** #include "string.h"
  36:Src/diag/Trace.c **** 
  37:Src/diag/Trace.c **** #ifndef OS_INTEGER_TRACE_PRINTF_TMP_ARRAY_SIZE
  38:Src/diag/Trace.c **** #define OS_INTEGER_TRACE_PRINTF_TMP_ARRAY_SIZE (128)
  39:Src/diag/Trace.c **** #endif
  40:Src/diag/Trace.c **** 
  41:Src/diag/Trace.c **** // ----------------------------------------------------------------------------
  42:Src/diag/Trace.c **** 
  43:Src/diag/Trace.c **** int
  44:Src/diag/Trace.c **** trace_printf(const char* format, ...)
  45:Src/diag/Trace.c **** {
  26              		.loc 1 45 0
  27              		.cfi_startproc
  28              		@ args = 4, pretend = 16, frame = 8
  29              		@ frame_needed = 0, uses_anonymous_args = 1
  30              	.LVL0:
  31 0000 0FB4     		push	{r0, r1, r2, r3}
  32              	.LCFI0:
  33              		.cfi_def_cfa_offset 16
  34              		.cfi_offset 0, -16
  35              		.cfi_offset 1, -12
  36              		.cfi_offset 2, -8
  37              		.cfi_offset 3, -4
  38 0002 00B5     		push	{lr}
  39              	.LCFI1:
  40              		.cfi_def_cfa_offset 20
  41              		.cfi_offset 14, -20
  42 0004 83B0     		sub	sp, sp, #12
  43              	.LCFI2:
  44              		.cfi_def_cfa_offset 32
  45 0006 04AB     		add	r3, sp, #16
  46 0008 53F8042B 		ldr	r2, [r3], #4
  46:Src/diag/Trace.c ****   int ret;
  47:Src/diag/Trace.c ****   va_list ap;
  48:Src/diag/Trace.c **** 
  49:Src/diag/Trace.c ****   va_start (ap, format);
  47              		.loc 1 49 0
  48 000c 0193     		str	r3, [sp, #4]
  50:Src/diag/Trace.c **** 
  51:Src/diag/Trace.c ****   // TODO: rewrite it to no longer use newlib, it is way too heavy
  52:Src/diag/Trace.c **** 
  53:Src/diag/Trace.c ****   static char buf[OS_INTEGER_TRACE_PRINTF_TMP_ARRAY_SIZE];
  54:Src/diag/Trace.c **** 
  55:Src/diag/Trace.c ****   // Print to the local buffer
  56:Src/diag/Trace.c ****   ret = vsnprintf (buf, sizeof(buf), format, ap);
  49              		.loc 1 56 0
  50 000e 8021     		movs	r1, #128
  51 0010 0648     		ldr	r0, .L4
  52 0012 FFF7FEFF 		bl	vsnprintf
  53              	.LVL1:
  57:Src/diag/Trace.c ****   if (ret > 0)
  54              		.loc 1 57 0
  55 0016 0028     		cmp	r0, #0
  56 0018 03DD     		ble	.L1
  58:Src/diag/Trace.c ****     {
  59:Src/diag/Trace.c ****       // Transfer the buffer to the device
ARM GAS  /tmp/ccQbm98O.s 			page 3


  60:Src/diag/Trace.c ****       ret = trace_write (buf, (size_t)ret);
  57              		.loc 1 60 0
  58 001a 0146     		mov	r1, r0
  59 001c 0348     		ldr	r0, .L4
  60              	.LVL2:
  61 001e FFF7FEFF 		bl	trace_write
  62              	.LVL3:
  63              	.L1:
  61:Src/diag/Trace.c ****     }
  62:Src/diag/Trace.c **** 
  63:Src/diag/Trace.c ****   va_end (ap);
  64:Src/diag/Trace.c ****   return ret;
  65:Src/diag/Trace.c **** }
  64              		.loc 1 65 0
  65 0022 03B0     		add	sp, sp, #12
  66              	.LCFI3:
  67              		.cfi_def_cfa_offset 20
  68              		@ sp needed
  69 0024 5DF804EB 		ldr	lr, [sp], #4
  70              	.LCFI4:
  71              		.cfi_restore 14
  72              		.cfi_def_cfa_offset 16
  73 0028 04B0     		add	sp, sp, #16
  74              	.LCFI5:
  75              		.cfi_restore 3
  76              		.cfi_restore 2
  77              		.cfi_restore 1
  78              		.cfi_restore 0
  79              		.cfi_def_cfa_offset 0
  80 002a 7047     		bx	lr
  81              	.L5:
  82              		.align	2
  83              	.L4:
  84 002c 00000000 		.word	.LANCHOR0
  85              		.cfi_endproc
  86              	.LFE1:
  88              		.section	.text.trace_puts,"ax",%progbits
  89              		.align	1
  90              		.global	trace_puts
  91              		.syntax unified
  92              		.thumb
  93              		.thumb_func
  94              		.fpu softvfp
  96              	trace_puts:
  97              	.LFB2:
  66:Src/diag/Trace.c **** 
  67:Src/diag/Trace.c **** int
  68:Src/diag/Trace.c **** trace_puts(const char *s)
  69:Src/diag/Trace.c **** {
  98              		.loc 1 69 0
  99              		.cfi_startproc
 100              		@ args = 0, pretend = 0, frame = 0
 101              		@ frame_needed = 0, uses_anonymous_args = 0
 102              	.LVL4:
 103 0000 10B5     		push	{r4, lr}
 104              	.LCFI6:
 105              		.cfi_def_cfa_offset 8
ARM GAS  /tmp/ccQbm98O.s 			page 4


 106              		.cfi_offset 4, -8
 107              		.cfi_offset 14, -4
 108 0002 0446     		mov	r4, r0
  70:Src/diag/Trace.c ****   trace_write(s, strlen(s));
 109              		.loc 1 70 0
 110 0004 FFF7FEFF 		bl	strlen
 111              	.LVL5:
 112 0008 0146     		mov	r1, r0
 113 000a 2046     		mov	r0, r4
 114 000c FFF7FEFF 		bl	trace_write
 115              	.LVL6:
  71:Src/diag/Trace.c ****   return trace_write("\n", 1);
 116              		.loc 1 71 0
 117 0010 0121     		movs	r1, #1
 118 0012 0248     		ldr	r0, .L8
 119 0014 FFF7FEFF 		bl	trace_write
 120              	.LVL7:
  72:Src/diag/Trace.c **** }
 121              		.loc 1 72 0
 122 0018 10BD     		pop	{r4, pc}
 123              	.LVL8:
 124              	.L9:
 125 001a 00BF     		.align	2
 126              	.L8:
 127 001c 00000000 		.word	.LC0
 128              		.cfi_endproc
 129              	.LFE2:
 131              		.section	.text.trace_putchar,"ax",%progbits
 132              		.align	1
 133              		.global	trace_putchar
 134              		.syntax unified
 135              		.thumb
 136              		.thumb_func
 137              		.fpu softvfp
 139              	trace_putchar:
 140              	.LFB3:
  73:Src/diag/Trace.c **** 
  74:Src/diag/Trace.c **** int
  75:Src/diag/Trace.c **** trace_putchar(int c)
  76:Src/diag/Trace.c **** {
 141              		.loc 1 76 0
 142              		.cfi_startproc
 143              		@ args = 0, pretend = 0, frame = 8
 144              		@ frame_needed = 0, uses_anonymous_args = 0
 145              	.LVL9:
 146 0000 00B5     		push	{lr}
 147              	.LCFI7:
 148              		.cfi_def_cfa_offset 4
 149              		.cfi_offset 14, -4
 150 0002 83B0     		sub	sp, sp, #12
 151              	.LCFI8:
 152              		.cfi_def_cfa_offset 16
 153 0004 02AB     		add	r3, sp, #8
 154 0006 43F8040D 		str	r0, [r3, #-4]!
  77:Src/diag/Trace.c ****   trace_write((const char*)&c, 1);
 155              		.loc 1 77 0
 156 000a 0121     		movs	r1, #1
ARM GAS  /tmp/ccQbm98O.s 			page 5


 157 000c 1846     		mov	r0, r3
 158              	.LVL10:
 159 000e FFF7FEFF 		bl	trace_write
 160              	.LVL11:
  78:Src/diag/Trace.c ****   return c;
  79:Src/diag/Trace.c **** }
 161              		.loc 1 79 0
 162 0012 0198     		ldr	r0, [sp, #4]
 163 0014 03B0     		add	sp, sp, #12
 164              	.LCFI9:
 165              		.cfi_def_cfa_offset 4
 166              		@ sp needed
 167 0016 5DF804FB 		ldr	pc, [sp], #4
 168              		.cfi_endproc
 169              	.LFE3:
 171              		.section	.text.trace_dump_args,"ax",%progbits
 172              		.align	1
 173              		.global	trace_dump_args
 174              		.syntax unified
 175              		.thumb
 176              		.thumb_func
 177              		.fpu softvfp
 179              	trace_dump_args:
 180              	.LFB4:
  80:Src/diag/Trace.c **** 
  81:Src/diag/Trace.c **** void
  82:Src/diag/Trace.c **** trace_dump_args(int argc, char* argv[])
  83:Src/diag/Trace.c **** {
 181              		.loc 1 83 0
 182              		.cfi_startproc
 183              		@ args = 0, pretend = 0, frame = 0
 184              		@ frame_needed = 0, uses_anonymous_args = 0
 185              	.LVL12:
 186 0000 70B5     		push	{r4, r5, r6, lr}
 187              	.LCFI10:
 188              		.cfi_def_cfa_offset 16
 189              		.cfi_offset 4, -16
 190              		.cfi_offset 5, -12
 191              		.cfi_offset 6, -8
 192              		.cfi_offset 14, -4
 193 0002 0546     		mov	r5, r0
 194 0004 0E46     		mov	r6, r1
  84:Src/diag/Trace.c ****   trace_printf("main(argc=%d, argv=[", argc);
 195              		.loc 1 84 0
 196 0006 0146     		mov	r1, r0
 197              	.LVL13:
 198 0008 0B48     		ldr	r0, .L18
 199              	.LVL14:
 200 000a FFF7FEFF 		bl	trace_printf
 201              	.LVL15:
 202              	.LBB2:
  85:Src/diag/Trace.c ****   for (int i = 0; i < argc; ++i)
 203              		.loc 1 85 0
 204 000e 0024     		movs	r4, #0
 205 0010 05E0     		b	.L13
 206              	.LVL16:
 207              	.L14:
ARM GAS  /tmp/ccQbm98O.s 			page 6


  86:Src/diag/Trace.c ****     {
  87:Src/diag/Trace.c ****       if (i != 0)
  88:Src/diag/Trace.c ****         {
  89:Src/diag/Trace.c ****           trace_printf(", ");
  90:Src/diag/Trace.c ****         }
  91:Src/diag/Trace.c ****       trace_printf("\"%s\"", argv[i]);
 208              		.loc 1 91 0 discriminator 2
 209 0012 56F82410 		ldr	r1, [r6, r4, lsl #2]
 210 0016 0948     		ldr	r0, .L18+4
 211 0018 FFF7FEFF 		bl	trace_printf
 212              	.LVL17:
  85:Src/diag/Trace.c ****   for (int i = 0; i < argc; ++i)
 213              		.loc 1 85 0 discriminator 2
 214 001c 0134     		adds	r4, r4, #1
 215              	.LVL18:
 216              	.L13:
  85:Src/diag/Trace.c ****   for (int i = 0; i < argc; ++i)
 217              		.loc 1 85 0 is_stmt 0 discriminator 1
 218 001e AC42     		cmp	r4, r5
 219 0020 05DA     		bge	.L17
  87:Src/diag/Trace.c ****         {
 220              		.loc 1 87 0 is_stmt 1
 221 0022 002C     		cmp	r4, #0
 222 0024 F5D0     		beq	.L14
  89:Src/diag/Trace.c ****         }
 223              		.loc 1 89 0
 224 0026 0648     		ldr	r0, .L18+8
 225 0028 FFF7FEFF 		bl	trace_printf
 226              	.LVL19:
 227 002c F1E7     		b	.L14
 228              	.L17:
 229              	.LBE2:
  92:Src/diag/Trace.c ****     }
  93:Src/diag/Trace.c ****   trace_printf("]);\n");
 230              		.loc 1 93 0
 231 002e 0548     		ldr	r0, .L18+12
 232 0030 FFF7FEFF 		bl	trace_printf
 233              	.LVL20:
 234 0034 70BD     		pop	{r4, r5, r6, pc}
 235              	.LVL21:
 236              	.L19:
 237 0036 00BF     		.align	2
 238              	.L18:
 239 0038 00000000 		.word	.LC1
 240 003c 1C000000 		.word	.LC3
 241 0040 18000000 		.word	.LC2
 242 0044 24000000 		.word	.LC4
 243              		.cfi_endproc
 244              	.LFE4:
 246              		.section	.bss.buf.5632,"aw",%nobits
 247              		.align	2
 248              		.set	.LANCHOR0,. + 0
 251              	buf.5632:
 252 0000 00000000 		.space	128
 252      00000000 
 252      00000000 
 252      00000000 
ARM GAS  /tmp/ccQbm98O.s 			page 7


 252      00000000 
 253              		.section	.rodata.trace_dump_args.str1.4,"aMS",%progbits,1
 254              		.align	2
 255              	.LC1:
 256 0000 6D61696E 		.ascii	"main(argc=%d, argv=[\000"
 256      28617267 
 256      633D2564 
 256      2C206172 
 256      67763D5B 
 257 0015 000000   		.space	3
 258              	.LC2:
 259 0018 2C2000   		.ascii	", \000"
 260 001b 00       		.space	1
 261              	.LC3:
 262 001c 22257322 		.ascii	"\"%s\"\000"
 262      00
 263 0021 000000   		.space	3
 264              	.LC4:
 265 0024 5D293B0A 		.ascii	"]);\012\000"
 265      00
 266              		.section	.rodata.trace_puts.str1.4,"aMS",%progbits,1
 267              		.align	2
 268              	.LC0:
 269 0000 0A00     		.ascii	"\012\000"
 270              		.text
 271              	.Letext0:
 272              		.file 2 "/home/mpitiot/opt/gcc-arm-none-eabi-6-2017-q1-update/lib/gcc/arm-none-eabi/6.3.1/include/
 273              		.file 3 "/home/mpitiot/opt/gcc-arm-none-eabi-6-2017-q1-update/lib/gcc/arm-none-eabi/6.3.1/include/
 274              		.file 4 "/home/mpitiot/opt/gcc-arm-none-eabi-6-2017-q1-update/arm-none-eabi/include/stdio.h"
 275              		.file 5 "/home/mpitiot/opt/gcc-arm-none-eabi-6-2017-q1-update/arm-none-eabi/include/sys/lock.h"
 276              		.file 6 "/home/mpitiot/opt/gcc-arm-none-eabi-6-2017-q1-update/arm-none-eabi/include/sys/_types.h"
 277              		.file 7 "/home/mpitiot/opt/gcc-arm-none-eabi-6-2017-q1-update/arm-none-eabi/include/sys/reent.h"
 278              		.file 8 "<built-in>"
 279              		.file 9 "/home/mpitiot/opt/gcc-arm-none-eabi-6-2017-q1-update/arm-none-eabi/include/sys/unistd.h"
 280              		.file 10 "Inc/diag/Trace.h"
 281              		.file 11 "/home/mpitiot/opt/gcc-arm-none-eabi-6-2017-q1-update/arm-none-eabi/include/string.h"
ARM GAS  /tmp/ccQbm98O.s 			page 8


DEFINED SYMBOLS
                            *ABS*:0000000000000000 Trace.c
     /tmp/ccQbm98O.s:16     .text.trace_printf:0000000000000000 $t
     /tmp/ccQbm98O.s:23     .text.trace_printf:0000000000000000 trace_printf
     /tmp/ccQbm98O.s:84     .text.trace_printf:000000000000002c $d
     /tmp/ccQbm98O.s:89     .text.trace_puts:0000000000000000 $t
     /tmp/ccQbm98O.s:96     .text.trace_puts:0000000000000000 trace_puts
     /tmp/ccQbm98O.s:127    .text.trace_puts:000000000000001c $d
     /tmp/ccQbm98O.s:132    .text.trace_putchar:0000000000000000 $t
     /tmp/ccQbm98O.s:139    .text.trace_putchar:0000000000000000 trace_putchar
     /tmp/ccQbm98O.s:172    .text.trace_dump_args:0000000000000000 $t
     /tmp/ccQbm98O.s:179    .text.trace_dump_args:0000000000000000 trace_dump_args
     /tmp/ccQbm98O.s:239    .text.trace_dump_args:0000000000000038 $d
     /tmp/ccQbm98O.s:247    .bss.buf.5632:0000000000000000 $d
     /tmp/ccQbm98O.s:251    .bss.buf.5632:0000000000000000 buf.5632
     /tmp/ccQbm98O.s:254    .rodata.trace_dump_args.str1.4:0000000000000000 $d
     /tmp/ccQbm98O.s:267    .rodata.trace_puts.str1.4:0000000000000000 $d
                     .debug_frame:0000000000000010 $d

UNDEFINED SYMBOLS
vsnprintf
trace_write
strlen
